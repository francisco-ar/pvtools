---

title: Pandas functions and hacks

keywords: fastai
sidebar: home_sidebar

summary: "Useful methods to manipulate pandas Dataframes and Timeseries data"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_utils.pandas_hacks.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DATAPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s1">&#39;data&#39;</span>
<span class="n">DATAPATH</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#1) [Path(&#39;/home/tc256760/Documents/lspv_dataAnalytics/data/sample_data.hdf&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">DATAPATH</span><span class="o">/</span><span class="s1">&#39;sample_data.hdf&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temp_air</th>
      <th>wind_speed</th>
      <th>wind_dir</th>
      <th>ghi</th>
      <th>dni</th>
      <th>dhi</th>
      <th>ghi30</th>
      <th>ref_cell_30</th>
      <th>pressure</th>
      <th>humidity</th>
    </tr>
    <tr>
      <th>Date UTC</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-01-01 00:00:00+00:00</th>
      <td>4.39</td>
      <td>1.87</td>
      <td>230.1</td>
      <td>-0.83</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>-1.17</td>
      <td>0.0</td>
      <td>1004.92</td>
      <td>86.8</td>
    </tr>
    <tr>
      <th>2019-01-01 01:00:00+00:00</th>
      <td>4.33</td>
      <td>2.87</td>
      <td>228.9</td>
      <td>-0.93</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>-1.06</td>
      <td>0.0</td>
      <td>1004.94</td>
      <td>86.8</td>
    </tr>
    <tr>
      <th>2019-01-01 02:00:00+00:00</th>
      <td>4.29</td>
      <td>2.86</td>
      <td>229.4</td>
      <td>-0.83</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>-1.17</td>
      <td>0.0</td>
      <td>1004.68</td>
      <td>86.7</td>
    </tr>
    <tr>
      <th>2019-01-01 03:00:00+00:00</th>
      <td>4.15</td>
      <td>2.04</td>
      <td>186.0</td>
      <td>-0.83</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>-1.06</td>
      <td>0.0</td>
      <td>1003.99</td>
      <td>85.7</td>
    </tr>
    <tr>
      <th>2019-01-01 04:00:00+00:00</th>
      <td>3.85</td>
      <td>1.91</td>
      <td>200.9</td>
      <td>-0.72</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>-0.85</td>
      <td>0.0</td>
      <td>1003.76</td>
      <td>87.5</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reindexing">Reindexing<a class="anchor-link" href="#Reindexing">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="group_monthly" class="doc_header"><code>group_monthly</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L9" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>group_monthly</code>(<strong><code>df</code></strong>:<code>Union</code>[<code>DataFrame</code>, <code>Series</code>], <strong><code>year</code></strong>=<em><code>2019</code></em>)</p>
</blockquote>
<p>Group DataFrame on a monthly basis</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_monthly</span> <span class="o">=</span> <span class="n">group_monthly</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df_monthly</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temp_air</th>
      <th>wind_speed</th>
      <th>wind_dir</th>
      <th>ghi</th>
      <th>dni</th>
      <th>dhi</th>
      <th>ghi30</th>
      <th>ref_cell_30</th>
      <th>pressure</th>
      <th>humidity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2069.29</td>
      <td>1435.01</td>
      <td>108055.89</td>
      <td>34917.68</td>
      <td>38239.26</td>
      <td>12362.45</td>
      <td>51715.35</td>
      <td>48610.01</td>
      <td>736835.33</td>
      <td>60544.44</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3239.50</td>
      <td>1006.93</td>
      <td>113466.64</td>
      <td>72346.55</td>
      <td>110533.67</td>
      <td>22688.93</td>
      <td>109435.71</td>
      <td>102650.54</td>
      <td>669755.92</td>
      <td>54066.06</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6729.26</td>
      <td>1553.95</td>
      <td>118829.39</td>
      <td>115350.27</td>
      <td>130062.69</td>
      <td>43622.62</td>
      <td>145409.34</td>
      <td>135521.01</td>
      <td>732658.25</td>
      <td>52248.47</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8610.21</td>
      <td>1226.82</td>
      <td>105979.29</td>
      <td>137613.23</td>
      <td>107280.93</td>
      <td>66850.14</td>
      <td>155924.54</td>
      <td>145176.13</td>
      <td>708537.10</td>
      <td>48822.63</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10545.47</td>
      <td>1512.52</td>
      <td>95941.20</td>
      <td>168002.63</td>
      <td>145783.34</td>
      <td>67029.82</td>
      <td>173376.89</td>
      <td>160543.15</td>
      <td>734502.29</td>
      <td>52783.08</td>
    </tr>
    <tr>
      <th>6</th>
      <td>15505.47</td>
      <td>1005.39</td>
      <td>115577.22</td>
      <td>200651.15</td>
      <td>189675.04</td>
      <td>64093.70</td>
      <td>201443.65</td>
      <td>188714.88</td>
      <td>710011.12</td>
      <td>49718.50</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-483270.44</td>
      <td>-498833.10</td>
      <td>-408692.31</td>
      <td>-262096.18</td>
      <td>-275386.74</td>
      <td>-497539.29</td>
      <td>-268543.55</td>
      <td>273642.34</td>
      <td>702204.35</td>
      <td>42311.47</td>
    </tr>
    <tr>
      <th>8</th>
      <td>16449.18</td>
      <td>1072.49</td>
      <td>114600.98</td>
      <td>173493.05</td>
      <td>170336.12</td>
      <td>49653.17</td>
      <td>190850.08</td>
      <td>182835.74</td>
      <td>736532.79</td>
      <td>51431.98</td>
    </tr>
    <tr>
      <th>9</th>
      <td>13177.18</td>
      <td>1134.01</td>
      <td>109943.21</td>
      <td>123016.56</td>
      <td>126421.37</td>
      <td>49262.50</td>
      <td>150130.23</td>
      <td>144564.05</td>
      <td>714218.45</td>
      <td>52099.68</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10583.85</td>
      <td>1985.31</td>
      <td>121106.32</td>
      <td>73931.99</td>
      <td>78220.40</td>
      <td>36173.01</td>
      <td>99013.16</td>
      <td>95937.87</td>
      <td>736211.77</td>
      <td>64640.29</td>
    </tr>
    <tr>
      <th>11</th>
      <td>5482.12</td>
      <td>1092.13</td>
      <td>134346.88</td>
      <td>35404.90</td>
      <td>31525.58</td>
      <td>23117.04</td>
      <td>49015.66</td>
      <td>47401.82</td>
      <td>705604.83</td>
      <td>65695.18</td>
    </tr>
    <tr>
      <th>12</th>
      <td>4540.22</td>
      <td>15331.70</td>
      <td>-10807.86</td>
      <td>24968.79</td>
      <td>32395.43</td>
      <td>14600.06</td>
      <td>39090.45</td>
      <td>37786.02</td>
      <td>736583.13</td>
      <td>65735.71</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reindex_monthly_en" class="doc_header"><code>reindex_monthly_en</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L14" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reindex_monthly_en</code>(<strong><code>data</code></strong>)</p>
</blockquote>
<p>Rename index to months</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reindex_monthly_en</span><span class="p">(</span><span class="n">df_monthly</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>temp_air</th>
      <th>wind_speed</th>
      <th>wind_dir</th>
      <th>ghi</th>
      <th>dni</th>
      <th>dhi</th>
      <th>ghi30</th>
      <th>ref_cell_30</th>
      <th>pressure</th>
      <th>humidity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Jan</th>
      <td>2069.29</td>
      <td>1435.01</td>
      <td>108055.89</td>
      <td>34917.68</td>
      <td>38239.26</td>
      <td>12362.45</td>
      <td>51715.35</td>
      <td>48610.01</td>
      <td>736835.33</td>
      <td>60544.44</td>
    </tr>
    <tr>
      <th>Feb</th>
      <td>3239.50</td>
      <td>1006.93</td>
      <td>113466.64</td>
      <td>72346.55</td>
      <td>110533.67</td>
      <td>22688.93</td>
      <td>109435.71</td>
      <td>102650.54</td>
      <td>669755.92</td>
      <td>54066.06</td>
    </tr>
    <tr>
      <th>Mar</th>
      <td>6729.26</td>
      <td>1553.95</td>
      <td>118829.39</td>
      <td>115350.27</td>
      <td>130062.69</td>
      <td>43622.62</td>
      <td>145409.34</td>
      <td>135521.01</td>
      <td>732658.25</td>
      <td>52248.47</td>
    </tr>
    <tr>
      <th>Apr</th>
      <td>8610.21</td>
      <td>1226.82</td>
      <td>105979.29</td>
      <td>137613.23</td>
      <td>107280.93</td>
      <td>66850.14</td>
      <td>155924.54</td>
      <td>145176.13</td>
      <td>708537.10</td>
      <td>48822.63</td>
    </tr>
    <tr>
      <th>May</th>
      <td>10545.47</td>
      <td>1512.52</td>
      <td>95941.20</td>
      <td>168002.63</td>
      <td>145783.34</td>
      <td>67029.82</td>
      <td>173376.89</td>
      <td>160543.15</td>
      <td>734502.29</td>
      <td>52783.08</td>
    </tr>
    <tr>
      <th>Jun</th>
      <td>15505.47</td>
      <td>1005.39</td>
      <td>115577.22</td>
      <td>200651.15</td>
      <td>189675.04</td>
      <td>64093.70</td>
      <td>201443.65</td>
      <td>188714.88</td>
      <td>710011.12</td>
      <td>49718.50</td>
    </tr>
    <tr>
      <th>Jul</th>
      <td>-483270.44</td>
      <td>-498833.10</td>
      <td>-408692.31</td>
      <td>-262096.18</td>
      <td>-275386.74</td>
      <td>-497539.29</td>
      <td>-268543.55</td>
      <td>273642.34</td>
      <td>702204.35</td>
      <td>42311.47</td>
    </tr>
    <tr>
      <th>Aug</th>
      <td>16449.18</td>
      <td>1072.49</td>
      <td>114600.98</td>
      <td>173493.05</td>
      <td>170336.12</td>
      <td>49653.17</td>
      <td>190850.08</td>
      <td>182835.74</td>
      <td>736532.79</td>
      <td>51431.98</td>
    </tr>
    <tr>
      <th>Sep</th>
      <td>13177.18</td>
      <td>1134.01</td>
      <td>109943.21</td>
      <td>123016.56</td>
      <td>126421.37</td>
      <td>49262.50</td>
      <td>150130.23</td>
      <td>144564.05</td>
      <td>714218.45</td>
      <td>52099.68</td>
    </tr>
    <tr>
      <th>Oct</th>
      <td>10583.85</td>
      <td>1985.31</td>
      <td>121106.32</td>
      <td>73931.99</td>
      <td>78220.40</td>
      <td>36173.01</td>
      <td>99013.16</td>
      <td>95937.87</td>
      <td>736211.77</td>
      <td>64640.29</td>
    </tr>
    <tr>
      <th>Nov</th>
      <td>5482.12</td>
      <td>1092.13</td>
      <td>134346.88</td>
      <td>35404.90</td>
      <td>31525.58</td>
      <td>23117.04</td>
      <td>49015.66</td>
      <td>47401.82</td>
      <td>705604.83</td>
      <td>65695.18</td>
    </tr>
    <tr>
      <th>Dec</th>
      <td>4540.22</td>
      <td>15331.70</td>
      <td>-10807.86</td>
      <td>24968.79</td>
      <td>32395.43</td>
      <td>14600.06</td>
      <td>39090.45</td>
      <td>37786.02</td>
      <td>736583.13</td>
      <td>65735.71</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="monthly" class="doc_header"><code>monthly</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L23" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>monthly</code>(<strong><code>data</code></strong>, <strong><code>year</code></strong>=<em><code>2019</code></em>)</p>
</blockquote>
<p>Group and reindex a DataFrame or Series monthly</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Scaling-functions">Scaling functions<a class="anchor-link" href="#Scaling-functions">&#182;</a></h2><p>We regularly need to scale data, these are basic fucntions that I use all the time (for plotting different quantities together for instance)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now <code>patch</code> this methods to the <code>pd.DataFrame</code> class</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataFrame.normalize" class="doc_header"><code>DataFrame.normalize</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataFrame.normalize</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Series.normalize" class="doc_header"><code>Series.normalize</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L39" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Series.normalize</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataFrame.min_max" class="doc_header"><code>DataFrame.min_max</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataFrame.min_max</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Series.min_max" class="doc_header"><code>Series.min_max</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L43" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Series.min_max</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>some quick tests</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>
<span class="n">abc</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
<span class="k">def</span> <span class="nf">create_random_df</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)):</span> <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">create_random_df</span><span class="p">()</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">min_max</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">test_close</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">min_max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A more elegant way of doing <code>slice(None)</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="flatten_cols" class="doc_header"><code>flatten_cols</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L50" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>flatten_cols</code>(<strong><code>df</code></strong>, <strong><code>to_str</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Flattens the columns MultiIndex</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Profiling-memory-usage-of-large-DataFrames">Profiling memory usage of large <code>DataFrames</code><a class="anchor-link" href="#Profiling-memory-usage-of-large-DataFrames">&#182;</a></h2><p>When reading data from <code>.csv</code> files, often we need to cast variables to the correct type (you rarely need 64 bit variables). This handy methods give you the memory usage and a quick reduce to cast down variables on the <code>DataFrame</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="mem_usage" class="doc_header"><code>mem_usage</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L61" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mem_usage</code>(<strong><code>pandas_obj</code></strong>)</p>
</blockquote>
<p>Detailed Memory usage of pandas object</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="reduce_mem_usage" class="doc_header"><code>reduce_mem_usage</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/utils/pandas_hacks.py#L70" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reduce_mem_usage</code>(<strong><code>df</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Casting down to <code>np.float32</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">create_random_df</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">small_df</span> <span class="o">=</span> <span class="n">reduce_mem_usage</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;before: {mem_usage(df)}, after: {mem_usage(small_df)}&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Reducing Memory-&gt;before: 0.15 MB, after: 0.08 MB
before: 0.15 MB, after: 0.08 MB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 20 columns):
a    1000 non-null float64
b    1000 non-null float64
c    1000 non-null float64
d    1000 non-null float64
e    1000 non-null float64
f    1000 non-null float64
g    1000 non-null float64
h    1000 non-null float64
i    1000 non-null float64
j    1000 non-null float64
k    1000 non-null float64
l    1000 non-null float64
m    1000 non-null float64
n    1000 non-null float64
o    1000 non-null float64
p    1000 non-null float64
q    1000 non-null float64
r    1000 non-null float64
s    1000 non-null float64
t    1000 non-null float64
dtypes: float64(20)
memory usage: 156.4 KB
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">small_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 20 columns):
a    1000 non-null float32
b    1000 non-null float32
c    1000 non-null float32
d    1000 non-null float32
e    1000 non-null float32
f    1000 non-null float32
g    1000 non-null float32
h    1000 non-null float32
i    1000 non-null float32
j    1000 non-null float32
k    1000 non-null float32
l    1000 non-null float32
m    1000 non-null float32
n    1000 non-null float32
o    1000 non-null float32
p    1000 non-null float32
q    1000 non-null float32
r    1000 non-null float32
s    1000 non-null float32
t    1000 non-null float32
dtypes: float32(20)
memory usage: 78.2 KB
</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

