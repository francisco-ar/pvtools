---

title: bifacialvf

keywords: fastai
sidebar: home_sidebar

summary: "A wrapper around NREL's bifacialvf, you need my version of [bifacialvf](http://github.com/tcapelle/bifacialvf). "
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_modelling.mybifacialvf.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="kn">import</span> <span class="n">show_doc</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's put some gps data:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>bifacialvf has hard-coded column names 🤣</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DATAPATH</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s1">&#39;data&#39;</span>
<span class="n">DATAPATH</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#2) [Path(&#39;/home/tc256760/Documents/capetools/data/pvgis_tmy_chambery.csv&#39;),Path(&#39;/home/tc256760/Documents/capetools/data/sample_data.hdf&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;sample_data.hdf&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">DATAPATH</span><span class="o">/</span><span class="n">fname</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ghi</th>
      <th>dni</th>
      <th>dhi</th>
      <th>temp_air</th>
      <th>wind_speed</th>
      <th>wind_dir</th>
      <th>pressure</th>
      <th>humidity</th>
      <th>zenith</th>
      <th>elevation</th>
      <th>azimuth</th>
    </tr>
    <tr>
      <th>Date UTC</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-01-01 00:00:00</th>
      <td>-0.83</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>4.39</td>
      <td>1.87</td>
      <td>230.1</td>
      <td>1004.92</td>
      <td>86.8</td>
      <td>157.029</td>
      <td>-67.029</td>
      <td>12.054</td>
    </tr>
    <tr>
      <th>2019-01-01 01:00:00</th>
      <td>-0.93</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>4.33</td>
      <td>2.87</td>
      <td>228.9</td>
      <td>1004.94</td>
      <td>86.8</td>
      <td>152.143</td>
      <td>-62.143</td>
      <td>42.533</td>
    </tr>
    <tr>
      <th>2019-01-01 02:00:00</th>
      <td>-0.83</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>4.29</td>
      <td>2.86</td>
      <td>229.4</td>
      <td>1004.68</td>
      <td>86.7</td>
      <td>143.742</td>
      <td>-53.742</td>
      <td>63.390</td>
    </tr>
    <tr>
      <th>2019-01-01 03:00:00</th>
      <td>-0.83</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>4.15</td>
      <td>2.04</td>
      <td>186.0</td>
      <td>1003.99</td>
      <td>85.7</td>
      <td>133.848</td>
      <td>-43.848</td>
      <td>78.092</td>
    </tr>
    <tr>
      <th>2019-01-01 04:00:00</th>
      <td>-0.72</td>
      <td>0.0</td>
      <td>-0.83</td>
      <td>3.85</td>
      <td>1.91</td>
      <td>200.9</td>
      <td>1003.76</td>
      <td>87.5</td>
      <td>123.435</td>
      <td>-33.435</td>
      <td>89.729</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rename_cols" class="doc_header"><code>rename_cols</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/modelling/mybifacialvf.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rename_cols</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>cols</code></strong>:<code>list</code>=<em><code>['dni', 'dhi', 'zenith', 'azimuth', 'elevation']</code></em>)</p>
</blockquote>
<p>Rename to upper case dni and ghi cols</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;ghi&#39;, &#39;dni&#39;, &#39;dhi&#39;, &#39;temp_air&#39;, &#39;wind_speed&#39;, &#39;wind_dir&#39;, &#39;pressure&#39;,
       &#39;humidity&#39;, &#39;zenith&#39;, &#39;elevation&#39;, &#39;azimuth&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">rename_cols</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will need to compare to pvfactors output, so we create a function to do that:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="format_output_as_pvfactor" class="doc_header"><code>format_output_as_pvfactor</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/modelling/mybifacialvf.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>format_output_as_pvfactor</code>(<strong><code>res</code></strong>:<code>DataFrame</code>, <strong><code>cuts</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Formats output from bifacialvf as pvfactor's one</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Engine">Engine<a class="anchor-link" href="#Engine">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_bifacialvf_simulation" class="doc_header"><code>run_bifacialvf_simulation</code><a href="https://github.com/tcapelle/capetools/tree/master/capetools/modelling/mybifacialvf.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_bifacialvf_simulation</code>(<strong><code>data</code></strong>:<code>DataFrame</code>, <strong><code>pvarray_parameters</code></strong>:<code>dict</code>=<em><code>{'rtr': 8.0, 'cellRows': 7, 'albedo': 0.4}</code></em>, <strong><code>gps_data</code></strong>:<code>dict</code>=<em><code>{'Name': 'Chambery', 'Latitude': 45.637001, 'Longitude': 5.881, 'Elevation': 235.0, 'TZ': -1.0}</code></em>)</p>
</blockquote>
<p>Run bifacialvf on data, with pvarray_parameters at location</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">run_bifacialvf_simulation</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;June 2019&#39;</span><span class="p">],</span> <span class="n">gps_data</span><span class="o">=</span><span class="n">CHAMBERY</span><span class="p">,</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>  0%|          | 0/720 [00:00&lt;?, ?it/s]/home/tc256760/Apps/bifacialvf/bifacialvf/vf.py:300: RuntimeWarning: divide by zero encountered in double_scalars
  projectedX2 = PcellX + np.float64(PcellY) / math.tan(startElvDown);      # Projection of ElvDown to ground in +x direction (X1 and X2 opposite nomenclature for front irradiance method)
  2%|▏         | 17/720 [00:00&lt;00:04, 161.21it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> 
********* 
Running Simulation for TMY3:  Chambery
Location:   Chambery
Lat:  45.637001  Long:  5.881  Tz  -1.0
Parameters: beta:  0   Sazm:  180   Height:  0.5   rtr separation:  8.0   Row type:  interior   Albedo:  0.4
Saving into output.csv
 
 
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 720/720 [00:03&lt;00:00, 224.07it/s]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Finished
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">output</span><span class="o">.</span><span class="n">qinc_back_mean</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-29-8062e29d8bc5&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>output<span class="ansi-blue-fg">.</span>qinc_back_mean<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span>figsize<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">12</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">5</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/envs/fastai/lib/python3.7/site-packages/pandas/core/generic.py</span> in <span class="ansi-cyan-fg">__getattr__</span><span class="ansi-blue-fg">(self, name)</span>
<span class="ansi-green-intense-fg ansi-bold">   5177</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_info_axis<span class="ansi-blue-fg">.</span>_can_hold_identifiers_and_holds_name<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   5178</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">[</span>name<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">-&gt; 5179</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> object<span class="ansi-blue-fg">.</span>__getattribute__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   5180</span> 
<span class="ansi-green-intense-fg ansi-bold">   5181</span>     <span class="ansi-green-fg">def</span> __setattr__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">,</span> value<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">AttributeError</span>: &#39;DataFrame&#39; object has no attribute &#39;qinc_back_mean&#39;</pre>
</div>
</div>

</div>
</div>

</div>
</div>
 

